"use strict";class SesmMain{sesm_do="";field_names={};scanner={};version="1.3.6";construct(){jQuery(document).ready((async function(){if(1!==jQuery("#sesm_container").length)return!1;await import("./modules/ajax.js").then(module=>{sesmScripts.ajax=new module.SesmAjax}),await import("./modules/template.js").then(module=>{sesmScripts.template=new module.SesmTemplate}),await sesmScripts.template.load_default_templates(),sesmScripts.load_field_names(),sesmScripts.add_event_listener(),sesmScripts.activate_sesm(),sesmScripts.is_mobile()}))}load_field_names(){this.field_names.price_title=__("Price","super-easy-stock-manager"),this.field_names.weight_title=__("Weight","super-easy-stock-manager"),this.field_names.quantity_title=__("Quantity","super-easy-stock-manager"),this.field_names.sku_title=__("SKU","super-easy-stock-manager"),this.field_names.iconclass=""}is_mobile(){return jQuery(window).width()<500||!!/Mobi|Android/i.test(navigator.userAgent)}add_event_listener(){jQuery("#sesm_buttons button").click((function(item){switch(sesmScripts.sesm_do=jQuery(item.currentTarget).data("do"),jQuery("#sesm_input .quant_flex_group").hide(),jQuery("#sesm_input .price_flex_group").hide(),jQuery("#sesm_buttons button.button-active").removeClass("button-active"),jQuery("#sesm_sku_input").slideDown("fast"),jQuery("#sesm_container #selection-indicator").slideDown("fast"),jQuery(item.currentTarget).addClass("button-active"),sesmScripts.is_mobile()?sesmScripts.show_scan_container():jQuery("#sesm_sku_input").focus(),sesmScripts.move_selection_indicator(),sesmScripts.sesm_do){case"add_quantities":jQuery(".sesm_options .quant_flex_group").slideDown("fast");break;case"update_price":jQuery(".sesm_options .price_flex_group").slideDown("fast")}})),jQuery("#scan-button").click(()=>{jQuery("#scan-button").hide(),jQuery("#scan-button-active").show(),sesmScripts.scanner=new Html5QrcodeScanner("scanner-container",{fps:10,qrbox:{width:250,height:250},useBarCodeDetectorIfSupported:!0,rememberLastUsedCamera:!0,showTorchButtonIfSupported:!0,defaultZoomValueIfSupported:2}),sesmScripts.scanner.render(sesmScripts.onScanSuccess,sesmScripts.onScanFailure)}),jQuery("#scan-button-active").click(()=>{jQuery("#scan-button").show(),jQuery("#scan-button-active").hide(),sesmScripts.scanner.clear()}),jQuery(document).on("keyup",(async function(s){13==s.which&&sesmScripts.fire_ajax()})),jQuery("#add_quant_btn").click((function(){sesmScripts.changeQuantity(!0)})),jQuery("#remove_quant_btn").click((function(){sesmScripts.changeQuantity(!1)})),jQuery("#sesm_container input").keyup(e=>{if(9===e.which||16===e.which||17===e.which)return;const value=e.currentTarget.value,id=e.currentTarget.id;sesmScripts.validate_input(value,id)?sesmScripts.remove_input_errors("#input-error-"+id):sesmScripts.show_input_error(id)}),jQuery(window).resize(()=>{sesmScripts.move_selection_indicator(0),sesmScripts.is_mobile()&&jQuery("#sesm_sku_input").attr("placeholder",__("Input SKU","super-easy-stock-manager"))})}async fire_ajax(){const ajaxResult=await sesmScripts.ajax.do_ajax();sesmScripts.empty(ajaxResult)?console.log("Failed to add to history: "+ajaxResult):sesmScripts.addToHistory(jQuery.parseJSON(ajaxResult))}onScanSuccess(code){if(sesmScripts.empty(code))return!1;jQuery("#sesm_sku_input").val(code),sesmScripts.scanner.clear(),jQuery("#scan-button").show(),jQuery("#scan-button-active").hide(),sesmScripts.fire_ajax(),console.log(code)}onScanFailure(message){console.log(message)}show_scan_container(){"flex"!==jQuery("#mobile-scan-container").css("display")&&(jQuery("#mobile-scan-container").css("display","flex"),jQuery("#mobile-scan-container").css("bottom",-jQuery("#mobile-scan-container").height()),jQuery("#mobile-scan-container").animate({bottom:0},200))}activate_sesm(){jQuery("#sesm_buttons").slideDown("fast")}move_selection_indicator(animationDuration=200){if(0===jQuery("#sesm_buttons .button-active").length)return;const activePosition=jQuery("#sesm_buttons .button-active")[0].offsetLeft,activeCenter=jQuery("#sesm_buttons .button-active").width()/2,padding=Number.parseInt(jQuery("#sesm_container").css("padding-left")),finalLeft=activePosition-padding+activeCenter;jQuery("#selection-indicator")[0].offsetLeft===padding&&(animationDuration=0,jQuery("#selection-indicator").animate({opacity:1},animationDuration)),jQuery("#selection-indicator").animate({left:finalLeft},animationDuration)}addToHistory(jsonData){let template=this.get_template_by_state(jsonData.template);this.empty(template)&&jQuery("#sesm_history").prepend(__(`Template "${jsonData.template}" not loaded`,"super-easy-stock-manager")),this.set_icon_class(jsonData.template);const attr=this.format_attributes(jsonData);this.empty(attr)||(jsonData.attributes=attr),jQuery.each(jsonData,(function(key,value){value=sesmScripts.format_value(key,value,jsonData),template=template.replaceAll("{{"+key+"}}",value)})),jQuery.each(this.field_names,(function(key,value){value=sesmScripts.format_value(key,value),template=template.replaceAll("{{"+key+"}}",value)})),jQuery("#sesm_history").addClass("active"),jQuery("#sesm_history").prepend(template),jQuery("#sesm_history article").first().animate({opacity:1,height:"100%"},500)}get_template_by_state(template){switch(template){case"error":return sesmScripts.template.loaded_templates.error;case"updateStock":return sesmScripts.template.loaded_templates.updatestock;case"updatePrice":return sesmScripts.template.loaded_templates.updateprice;default:return sesmScripts.template.loaded_templates.item}}set_icon_class(template){let classname="";switch(template){case"get":classname="fas fa-question";break;case"updateStock":classname="fas fa-box-open";break;case"updatePrice":classname="far fa-money-bill-alt"}this.field_names.iconclass=classname}format_attributes(jsonData){return this.empty(jsonData.attributes)?"":jsonData.attributes.replace(", ","<br/>")}format_value(fieldName,value,jsonData){switch(fieldName){case"stock_quantity":const number=parseInt(value);return number<1?"<span class='red'>"+number+"</span>":value;case"regular_price":return jsonData.sale_price?'<span class="strikethrough">'+value+" "+jsonData.currency+"</span>":value+" "+jsonData.currency;case"weight":return value+" kg";case"sale_price":return jsonData.sale_price?value+" "+jsonData.currency:"";case"manage_stock":return!1!==value?"":__("Stock management got activated","super-easy-stock-manager");case"to_regular":return sesmScripts.format_price_change(jsonData.from_regular,jsonData.to_regular,jsonData,fieldName);case"to_sale":return sesmScripts.format_price_change(jsonData.from_sale,jsonData.to_sale,jsonData,fieldName);default:return value}}format_price_change(fromPrice,toPrice,jsonData,fieldName){const priceLength=(jsonData.from_regular+jsonData.to_regular+jsonData.currency).length,priceLengthSale=(jsonData.from_sale+jsonData.to_sale+jsonData.currency).length,priceNotice="to_regular"===fieldName?jsonData.regular_notice:jsonData.sale_notice;if(!sesmScripts.empty(priceNotice))return'<div class="info-text">'+priceNotice+"</div>";if(fromPrice===toPrice)return"";if(sesmScripts.empty(toPrice))return"";const classLongContent=priceLength+priceLengthSale>7||jsonData.to_sale>0?"content-long":"",isSingleRegularClass=0===jsonData.to_sale?"single":"",isSingleSaleClass=0===jsonData.to_regular?"single":"";return"to_regular"===fieldName?'<div class="'+classLongContent+" "+isSingleRegularClass+'"><span class="from_price strikethrough">'+fromPrice+" "+jsonData.currency+'</span><span class="to_price">'+toPrice+" "+jsonData.currency+"</span></div>":'<div class="'+classLongContent+" "+isSingleSaleClass+'"><span class="from_price strikethrough">'+fromPrice+" "+jsonData.currency+'</span><span class="to_price">'+toPrice+" "+jsonData.currency+"</span></div>"}changeQuantity(add){const quant=this.empty(jQuery("#sesm_quant").val())?0:parseInt(jQuery("#sesm_quant").val());let newQuant=0;newQuant=!0===add?quant+1==0?1:quant+1:quant-1==0?-1:quant-1,newQuant=Number.isInteger(newQuant)?newQuant:0,jQuery("#sesm_quant").val(newQuant),jQuery("#sesm_sku_input").focus()}validate_input(value,type){let regex="";const allowEmpty=!0;switch(type){case"sesm_quant":regex=/^[0-9\.,]{1,}$/g;break;case"sesm_price_reg":case"sesm_price_sale":regex=/^[0-9\.,]{1,}$/g}return!!sesmScripts.empty(value)||!sesmScripts.empty(regex)&&null!==regex.exec(value)}show_input_error(id){let message="";switch(id){case"sesm_quant":message=__("The Quantity contains invalid characters. Only 0-9, comma (,) and period (.) are allowed","super-easy-stock-manager");break;case"sesm_price_reg":case"sesm_price_sale":message=__("The Price contains invalid characters. Only 0-9, comma (,) and period (.) are allowed","super-easy-stock-manager")}if(sesmScripts.empty(message))return!1;const tooltip=sesmScripts.template.apply_template(sesmScripts.template.loaded_templates.errortooltip,{error:message,id:id});0===jQuery("#input-error-"+id).length&&jQuery("#"+id).before(tooltip)}remove_input_errors(item=".input-error-field"){jQuery("#sesm_container "+item).remove()}empty(value){return null===value||(void 0===value||0===value.length)}}const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n,sesmScripts=new SesmMain;sesmScripts.construct();