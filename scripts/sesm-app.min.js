class sesmMain{sesm_do="";field_names={};scanner={};construct(){jQuery(document).ready((async function(){await import("./modules/ajax.js").then(module=>{sesm_scripts.ajax=new module.SesmAjax}),await import("./modules/template.js").then(module=>{sesm_scripts.template=new module.SesmTemplate}),await sesm_scripts.template.load_default_templates(),sesm_scripts.load_field_names(),sesm_scripts.add_event_listener(),sesm_scripts.activate_sesm(),sesm_scripts.is_mobile()}))}load_field_names(){this.field_names.price_title=__("Price","sesm"),this.field_names.weight_title=__("Weight","sesm"),this.field_names.quantity_title=__("Quantity","sesm"),this.field_names.sku_title=__("SKU","sesm"),this.field_names.iconclass=""}is_mobile(){return jQuery(window).width()<500||!!/Mobi|Android/i.test(navigator.userAgent)}add_event_listener(){jQuery("#sesm_buttons button").click((function(){switch(sesm_scripts.sesm_do=jQuery(this).data("do"),jQuery("#sesm_input .quant_flex_group").hide(),jQuery("#sesm_input .price_flex_group").hide(),jQuery("#sesm_buttons button.button-active").removeClass("button-active"),jQuery("#sesm_sku_input").slideDown("fast"),jQuery("#sesm_container #selection-indicator").slideDown("fast"),jQuery(this).addClass("button-active"),sesm_scripts.is_mobile?sesm_scripts.show_scan_container():jQuery("#sesm_sku_input").focus(),sesm_scripts.move_selection_indicator(),sesm_scripts.sesm_do){case"add_quantities":jQuery(".sesm_options .quant_flex_group").slideDown("fast");break;case"update_price":jQuery(".sesm_options .price_flex_group").slideDown("fast")}})),jQuery("#scan-button").click(()=>{jQuery("#scan-button").hide(),jQuery("#scan-button-active").show(),sesm_scripts.scanner=new Html5QrcodeScanner("scanner-container",{fps:10,qrbox:{width:250,height:250},useBarCodeDetectorIfSupported:!0,rememberLastUsedCamera:!0,showTorchButtonIfSupported:!0,defaultZoomValueIfSupported:2}),sesm_scripts.scanner.render(sesm_scripts.onScanSuccess,sesm_scripts.onScanFailure)}),jQuery("#scan-button-active").click(()=>{jQuery("#scan-button").show(),jQuery("#scan-button-active").hide(),sesm_scripts.scanner.clear()}),jQuery(document).on("keyup",(async function(s){13==s.which&&sesm_scripts.fire_ajax()})),jQuery("#add_quant_btn").click((function(){sesm_scripts.changeQuantity(!0)})),jQuery("#remove_quant_btn").click((function(){sesm_scripts.changeQuantity(!1)})),jQuery(window).resize(()=>{sesm_scripts.move_selection_indicator(0),sesm_scripts.is_mobile()&&jQuery("#sesm_sku_input").attr("placeholder",__("Input SKU","sesm"))})}async fire_ajax(){const ajax_result=await sesm_scripts.ajax.do_ajax();sesm_scripts.empty(ajax_result)?console.log("Failed to add to history: "+ajax_result):sesm_scripts.addToHistory(jQuery.parseJSON(ajax_result))}onScanSuccess(code){if(sesm_scripts.empty(code))return!1;jQuery("#sesm_sku_input").val(code),sesm_scripts.scanner.clear(),jQuery("#scan-button").show(),jQuery("#scan-button-active").hide(),sesm_scripts.fire_ajax(),console.log(code)}onScanFailure(message){console.log(message)}show_scan_container(){jQuery("#mobile-scan-container").css("display","flex"),jQuery("#mobile-scan-container").css("bottom",-jQuery("#mobile-scan-container").height()),jQuery("#mobile-scan-container").animate({bottom:0},200)}activate_sesm(){jQuery("#sesm_buttons").slideDown("slow")}move_selection_indicator(animation_duration=200){if(0===jQuery("#sesm_buttons .button-active").length)return;const active_position=jQuery("#sesm_buttons .button-active").offset().left,active_position_top=jQuery("#sesm_buttons .button-active").offset().top;0===jQuery("#selection-indicator").offset().top&&(animation_duration=0),jQuery("#selection-indicator").animate({left:active_position+jQuery("#sesm_buttons .button-active").width()/2,top:active_position_top+(jQuery("#sesm_buttons .button-active").height()+2)},animation_duration)}addToHistory(json_data){var template=this.get_template_by_state(json_data.template);this.empty(template)&&jQuery("#sesm_history").prepend(__(`Template "${json_data.template}" not loaded`,"sesm")),this.set_icon_class(json_data.template);const attr=this.format_attributes(json_data);this.empty(attr)||(json_data.attributes=attr),jQuery.each(json_data,(function(key,value){value=sesm_scripts.format_value(key,value,json_data),template=template.replaceAll("{{"+key+"}}",value)})),jQuery.each(this.field_names,(function(key,value){value=sesm_scripts.format_value(key,value),template=template.replaceAll("{{"+key+"}}",value)})),jQuery("#sesm_history").addClass("active"),jQuery("#sesm_history").prepend(template),jQuery("#sesm_history article").first().animate({opacity:1,height:"100%"},500)}get_template_by_state(template){switch(template){case"error":return sesm_scripts.template.loaded_templates.error;case"updateStock":return sesm_scripts.template.loaded_templates.updatestock;case"updatePrice":return sesm_scripts.template.loaded_templates.updateprice;default:return sesm_scripts.template.loaded_templates.item}}set_icon_class(template){let classname="";switch(template){case"get":classname="fas fa-question";break;case"updateStock":classname="fas fa-box-open";break;case"updatePrice":classname="far fa-money-bill-alt"}this.field_names.iconclass=classname}format_attributes(json_data){return this.empty(json_data.attributes)?"":json_data.attributes.replace(", ","<br/>")}format_value(field_name,value,json_data){if("to_regular"===field_name||"to_sale"===field_name)var price_length=(json_data.from_regular+json_data.to_regular+json_data.currency).length,price_length_sale=(json_data.from_sale+json_data.to_sale+json_data.currency).length;switch(field_name){case"stock_quantity":var number=parseInt(value);return number<1?"<span class='red'>"+number+"</span>":value;case"regular_price":return json_data.sale_price?'<span class="strikethrough">'+value+" "+json_data.currency+"</span>":value+" "+json_data.currency;case"weight":return value+" kg";case"sale_price":return json_data.sale_price?value+" "+json_data.currency:"";case"manage_stock":return!1!==value?"":__("Stock management got activated","sesm");case"to_regular":const class_long_content=price_length+price_length_sale>7||json_data.to_sale>0?"content-long":"",is_single_regular_class=0===json_data.to_sale?"single":"";return 0===value?"":'<div class="'+class_long_content+" "+is_single_regular_class+'"><span class="from_price strikethrough">'+json_data.from_regular+" "+json_data.currency+'</span><span class="to_price">'+value+" "+json_data.currency+"</span></div>";case"to_sale":const class_long_content_sale=price_length+price_length_sale>7||json_data.to_regular>0?"content-long":"",is_single_sale_class=0===json_data.to_regular?"single":"";return 0===value?"":'<div class="'+class_long_content_sale+" "+is_single_sale_class+'"><span class="from_price strikethrough">'+json_data.from_sale+" "+json_data.currency+'</span><span class="to_price">'+value+" "+json_data.currency+"</span></div>";default:return value}}changeQuantity(add){var quant=this.empty(jQuery("#sesm_quant").val())?0:parseInt(jQuery("#sesm_quant").val()),newQuant=0;newQuant=!0===add?quant+1==0?1:quant+1:quant-1==0?-1:quant-1,newQuant=Number.isInteger(newQuant)?newQuant:0,jQuery("#sesm_quant").val(newQuant),jQuery("#sesm_sku_input").focus()}empty(value){return null===value||(void 0===value||0===value.length)}}const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;let sesm_scripts=new sesmMain;sesm_scripts.construct();